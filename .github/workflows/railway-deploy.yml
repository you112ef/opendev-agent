name: ğŸš‚ Deploy to Railway

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

jobs:
  deploy:
    name: Deploy to Railway
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ” Check Railway files
        run: |
          ls -la railway.*
          ls -la Dockerfile
          echo "âœ… All deployment files exist"
      
      - name: ğŸš‚ Install Railway CLI
        run: |
          npm install -g @railway/cli
          railway --version
      
      - name: ğŸ”‘ Authenticate with Railway
        run: |
          echo "RAILWAY_TOKEN=${{ env.RAILWAY_TOKEN }}" > ~/.railway
          railway whoami
      
      - name: ğŸ“¦ Deploy to Railway
        run: |
          cd /project/workspace/OpenDevAgent_Platform
          railway up --detach
        env:
          RAILWAY_TOKEN: ${{ env.RAILWAY_TOKEN }}
  
  notify:
    name: ğŸ“¢ Notify on completion
    runs-on: ubuntu-latest
    needs: deploy
    if: always()
    
    steps:
      - name: âœ… Deployment completed
        run: |
          echo "ğŸ‰ Deployment to Railway completed!"
          echo "ğŸ“ Visit: https://railway.app/dashboard"
          echo "âœ¨ Your app should be live in 5-10 minutes"
